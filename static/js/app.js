$(document).ready(function(){function e(e,n){var a=$(document.createElement("li")).addClass("message "+(n?"external":"internal")),o=$(document.createElement("div")).text(e.message).css({backgroundColor:e.color}).attr("data-color",e.color),s=$(document.createElement("div")).addClass("tip").css({borderColor:e.color}),r=$(document.createElement("div")).text(e.nickname);o.addClass("text"),o.append(s),r.addClass("nickname"),n?a.append(o,r):a.append(r,o),d.append(a),t()}function n(e){console.log(e);var n=$(document.createElement("li")).addClass("info");n.text(e.message),d.append(n),t()}function t(){d.scrollTop(d[0].scrollHeight)}var a=io.connect("http://"+location.host),o=$(".chatBody .welcomeBlock"),s=o.find(".nicknameForm"),r=s.find(".nicknameInput"),c=$(".chatBody .chatBlock"),d=c.find(".messageList"),i=c.find(".messageForm"),l=i.find(".indicator"),m=i.find(".messageInput"),u=400,f=!1;$(".nicknameForm").submit(function(e){var n=r.val().trim();e.preventDefault(),n&&(a.emit("enter",{nickname:n}),a.on("enter response",function(e){if(e.accepted)console.log("ACCEPTED"),f=!0,s.find(".error").addClass("hidden"),r.blur(),o.addClass("hidden"),setTimeout(function(){o.remove(),c.removeClass("hidden"),m.focus()},500);else{console.log("REJECTED: "+e.message),s.find(".error").remove();var n=$(document.createElement("p")).addClass("error").text(e.message);s.append(n)}}))}),m.keyup(function(){var e=$(this).val(),n=e.length,t=u-n;0===n?l.text(""):(l.text(t),l.attr("class",0>t?"bad":""))}),i.submit(function(e){var n=m.val().trim();e.preventDefault(),n&&(a.emit("message",{message:n}),m.val(""),i.find(".error").remove())}),a.on("message",function(n){f&&e(n,n.external)}),a.on("message response",function(e){var n=$(document.createElement("p")).addClass("error").text(e.message);i.append(n)}),a.on("info",function(e){console.log(e),f&&n(e)})});