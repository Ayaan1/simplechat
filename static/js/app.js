document.addEventListener("DOMContentLoaded",function(){function e(e,n){console.log(n);var t=$(document.createElement("li")).addClass("message "+(n?"external":"internal")),a=$(document.createElement("div")).text(e.message).css({backgroundColor:e.color}),o=$(document.createElement("div")).text(e.nickname);a.addClass("text"),o.addClass("nickname"),n?t.append(o,a):t.append(a,o),d.append(t)}var n=io.connect("http://"+location.host),t=$(".chatBody .welcomeBlock"),a=t.find(".nicknameForm"),o=a.find(".nicknameInput"),s=$(".chatBody .chatBlock"),d=s.find(".messageList"),c=s.find(".messageForm"),i=c.find(".messageInput"),m=!1;$(".nicknameForm").submit(function(e){var d=o.val().trim();e.preventDefault(),d&&(n.emit("enter",{nickname:d}),n.on("enter response",function(e){if(e.accepted)console.log("ACCEPTED"),m=!0,a.find(".error").addClass("hidden"),o.blur(),t.addClass("hidden"),setTimeout(function(){t.remove(),s.removeClass("hidden"),i.focus()},500);else{console.log("REJECTED: "+e.message),a.find(".error").remove();var n=$(document.createElement("p")).addClass("error").text(e.message);a.append(n)}}))}),c.submit(function(e){var t=i.val().trim();e.preventDefault(),t&&(n.emit("message",{message:t}),i.val(""))}),n.on("message",function(n){console.log(n),m&&e(n,n.external)})});