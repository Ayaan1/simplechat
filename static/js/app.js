$(document).ready(function(){function e(e,t){var a=$(document.createElement("li")).addClass("message "+(t?"external":"internal")),o=$(document.createElement("div")).text(e.message).css({backgroundColor:e.color}).attr("data-color",e.color),r=$(document.createElement("div")).addClass("tip").css({borderColor:e.color}),s=$(document.createElement("div")).text(e.nickname);o.addClass("text"),o.append(r),s.addClass("nickname"),t?a.append(o,s):a.append(s,o),i.append(a),n()}function t(e){var t=$(document.createElement("li")).addClass("info");t.text(e.message),i.append(t),n()}function n(){i.scrollTop(i[0].scrollHeight)}var a=io.connect("http://"+location.host),o=$(".chatBody .welcomeBlock"),r=o.find(".nicknameForm"),s=r.find(".nicknameInput"),d=$(".chatBody .chatBlock"),i=d.find(".messageList"),c=d.find(".messageForm"),m=c.find(".indicator"),l=c.find(".messageInput"),u=400,f=!1;$(".nicknameForm").submit(function(e){var t=s.val().trim();s.attr("disabled",!0),e.preventDefault(),t&&(a.emit("enter",{nickname:t}),a.on("enter response",function(e){if(e.accepted)f=!0,r.find(".error").addClass("hidden"),s.blur(),o.addClass("hidden"),setTimeout(function(){o.remove(),d.removeClass("hidden"),l.focus()},500);else{s.removeAttr("disabled"),r.find(".error").remove();var t=$(document.createElement("p")).addClass("error").text(e.message);r.append(t)}}))}),l.keyup(function(){var e=$(this).val(),t=e.length,n=u-t;0===t?m.text(""):(m.text(n),m.attr("class","indicator "+(0>n?"bad":"")))}),c.submit(function(e){var t=l.val().trim();e.preventDefault(),t&&(a.emit("message",{message:t}),l.val(""),m.text(""),c.find(".error").remove())}),a.on("message",function(t){f&&e(t,t.external)}),a.on("message response",function(e){var t=$(document.createElement("p")).addClass("error").text(e.message);c.append(t)}),a.on("info",function(e){f&&t(e)})});